<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Web Shop</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: var(--tg-theme-bg-color, #fff);
    color: var(--tg-theme-text-color, #000);
    margin: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .product-list {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
  }
  .product {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 15px;
    width: 180px;
    text-align: center;
    background: var(--tg-theme-button-color, #f0f0f0);
    color: var(--tg-theme-button-text-color, #000);
  }
  .product img {
    max-width: 100%;
    border-radius: 6px;
    margin-bottom: 10px;
  }
  .product button {
    margin-top: 10px;
    padding: 8px 12px;
    font-weight: 600;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background: var(--tg-theme-button-color, #0088cc);
    color: var(--tg-theme-button-text-color, #fff);
  }
  .cart {
    max-width: 400px;
    margin: 0 auto;
    border-top: 2px solid var(--tg-theme-button-color, #0088cc);
    padding-top: 15px;
  }
  .cart h2 {
    text-align: center;
    margin-bottom: 15px;
  }
  .cart-items {
    list-style: none;
    padding-left: 0;
    margin-bottom: 15px;
  }
  .cart-items li {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .cart-total {
    font-weight: 700;
    text-align: right;
    margin-bottom: 15px;
  }
  .pay-btn {
    display: block;
    width: 100%;
    padding: 12px 0;
    font-size: 18px;
    font-weight: 700;
    border: none;
    border-radius: 6px;
    background: var(--tg-theme-button-color, #0088cc);
    color: var(--tg-theme-button-text-color, #fff);
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Простой интернет-магазин для Telegram Web</h1>

<div class="product-list" id="product-list">
  <!-- Товары будут вставлены скриптом -->
</div>

<div class="cart">
  <h2>Корзина</h2>
  <ul class="cart-items" id="cart-items">
    <li>Корзина пуста</li>
  </ul>
  <div class="cart-total" id="cart-total">Итого: 0 ₽</div>
  <button class="pay-btn" id="pay-btn" disabled>Оплатить</button>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const tg = window.Telegram.WebApp;
  tg.expand(); // расширяем окно под контент

  // Данные товаров
  const products = [
    {
      id: 1,
      name: "Товар 1",
      price: 500,
      img: "https://via.placeholder.com/150?text=Товар+1"
    },
    {
      id: 2,
      name: "Товар 2",
      price: 800,
      img: "https://via.placeholder.com/150?text=Товар+2"
    }
  ];

  // Корзина - объект с id товара и количеством
  const cart = {};

  const productListEl = document.getElementById("product-list");
  const cartItemsEl = document.getElementById("cart-items");
  const cartTotalEl = document.getElementById("cart-total");
  const payBtn = document.getElementById("pay-btn");

  // Функция отрисовки товаров
  function renderProducts() {
    productListEl.innerHTML = "";
    products.forEach(product => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${product.img}" alt="${product.name}" />
        <div><strong>${product.name}</strong></div>
        <div>Цена: ${product.price} ₽</div>
        <button data-id="${product.id}">Добавить в корзину</button>
      `;
      productListEl.appendChild(div);
    });
  }

  // Функция обновления корзины
  function updateCart() {
    cartItemsEl.innerHTML = "";
    const ids = Object.keys(cart);
    if (ids.length === 0) {
      cartItemsEl.innerHTML = "<li>Корзина пуста</li>";
      cartTotalEl.textContent = "Итого: 0 ₽";
      payBtn.disabled = true;
      return;
    }
    let total = 0;
    ids.forEach(id => {
      const product = products.find(p => p.id == id);
      const qty = cart[id];
      const itemTotal = product.price * qty;
      total += itemTotal;
      const li = document.createElement("li");
      li.textContent = `${product.name} x${qty} — ${itemTotal} ₽`;
      cartItemsEl.appendChild(li);
    });
    cartTotalEl.textContent = `Итого: ${total} ₽`;
    payBtn.disabled = false;
  }

  // Добавление товара в корзину
  productListEl.addEventListener("click", e => {
    if (e.target.tagName === "BUTTON") {
      const id = e.target.getAttribute("data-id");
      if (!cart[id]) cart[id] = 0;
      cart[id]++;
      updateCart();
    }
  });

  // Обработка кнопки оплаты
  payBtn.addEventListener("click", () => {
    const ids = Object.keys(cart);
    if (ids.length === 0) return;

    // Формируем описание и сумму для инвойса
    let totalAmount = 0;
    let description = "Оплата тестового заказа: ";
    ids.forEach((id, i) => {
      const product = products.find(p => p.id == id);
      const qty = cart[id];
      totalAmount += product.price * qty;
      description += `${product.name} x${qty}`;
      if (i < ids.length - 1) description += ", ";
    });

    // Создаем инвойс через Telegram WebApp API
    // Для теста используем метод tg.sendInvoice (если доступен)
    // Но в WebApp JS API прямого метода для создания инвойса нет,
    // обычно инвойс создается через бота на сервере,
    // здесь отправим данные в бота для создания инвойса.

    // Отправляем данные в бота
    tg.sendData(JSON.stringify({
      type: "invoice",
      amount: totalAmount,
      description: description,
      cart: cart
    }));

    // Можно показать пользователю уведомление
    alert("Данные для оплаты отправлены боту. Проверьте чат Telegram.");
  });

  // Инициализация
  renderProducts();
  updateCart();

</script>
</body>
</html>
