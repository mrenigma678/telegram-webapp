<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Mini App Магазин</title>
  <style>
    /* Ваши стили */
    body { font-family: Arial, sans-serif; padding: 20px; }
    .product { margin-bottom: 15px; }
    .cart { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Магазин</h1>

  <div id="products">
    <!-- Пример товаров -->
    <div class="product" data-id="1" data-name="Товар 1" data-price="1500">
      <b>Товар 1</b> — 1500 руб
      <button class="add-to-cart">Добавить в корзину</button>
    </div>
    <div class="product" data-id="2" data-name="Товар 2" data-price="3000">
      <b>Товар 2</b> — 3000 руб
      <button class="add-to-cart">Добавить в корзину</button>
    </div>
    <div class="product" data-id="3" data-name="Товар 3" data-price="500">
      <b>Товар 3</b> — 500 руб
      <button class="add-to-cart">Добавить в корзину</button>
    </div>
  </div>

  <div class="cart">
    <h2>Корзина</h2>
    <ul id="cart-list"></ul>
    <p>Итого: <span id="total-price">0</span> руб</p>
    <button id="pay-btn">Оплатить</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const cart = {};

    const productsDiv = document.getElementById('products');
    const cartList = document.getElementById('cart-list');
    const totalPriceEl = document.getElementById('total-price');
    const payBtn = document.getElementById('pay-btn');

    productsDiv.addEventListener('click', (e) => {
      if (e.target.classList.contains('add-to-cart')) {
        const productDiv = e.target.closest('.product');
        const id = productDiv.dataset.id;
        const name = productDiv.dataset.name;
        const price = Number(productDiv.dataset.price);

        if (cart[id]) {
          cart[id].count++;
        } else {
          cart[id] = { name, price, count: 1 };
        }
        renderCart();
      }
    });

    function renderCart() {
      cartList.innerHTML = '';
      let total = 0;
      for (const id in cart) {
        const item = cart[id];
        const li = document.createElement('li');
        li.textContent = `${item.name} x${item.count} — ${item.price * item.count} руб`;
        cartList.appendChild(li);
        total += item.price * item.count;
      }
      totalPriceEl.textContent = total;
    }

    function getCartForBot() {
      const cartForBot = {};
      for (const key in cart) {
        cartForBot[key] = {
          name: cart[key].name,
          price: cart[key].price,
          count: cart[key].count,
        };
      }
      return cartForBot;
    }

    payBtn.addEventListener('click', () => {
      const cartData = getCartForBot();
      if (Object.keys(cartData).length === 0) {
        alert('Корзина пуста!');
        return;
      }
      tg.sendData(JSON.stringify({ cart: cartData }));
      alert('Ожидайте, сейчас откроется окно оплаты...');
    });
  </script>
</body>
</html>
